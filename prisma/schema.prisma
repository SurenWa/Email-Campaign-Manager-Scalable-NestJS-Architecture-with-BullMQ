// Prisma Schema for Email Campaign Manager

generator client {
    provider = "prisma-client-js"
    previewFeatures = ["driverAdapters"]
}

datasource db {
    provider = "postgresql"
}

// ============================================
// ENUMS
// ============================================

enum Role {
    USER
    ADMIN
}

enum CampaignStatus {
    DRAFT
    SCHEDULED
    SENDING
    SENT
    FAILED
    CANCELLED
}

enum EmailStatus {
    PENDING
    QUEUED
    SENT
    DELIVERED
    BOUNCED
    FAILED
}

// ============================================
// MODELS
// ============================================

model User {
    id        String   @id @default(cuid())
    email     String   @unique
    name      String
    password  String
    role      Role     @default(USER)
    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @updatedAt @map("updated_at")

    campaigns Campaign[]

    @@map("users")
}

model Campaign {
    id          String         @id @default(cuid())
    name        String
    subject     String
    content     String         @db.Text
    recipients  String[]
    status      CampaignStatus @default(DRAFT)
    scheduledAt DateTime?      @map("scheduled_at")
    sentAt      DateTime?      @map("sent_at")
    createdAt   DateTime       @default(now()) @map("created_at")
    updatedAt   DateTime       @updatedAt @map("updated_at")

    userId    String     @map("user_id")
    user      User       @relation(fields: [userId], references: [id], onDelete: Cascade)
    emailLogs EmailLog[]

    @@index([userId])
    @@index([status])
    @@index([scheduledAt])
    @@map("campaigns")
}

model EmailLog {
    id          String      @id @default(cuid())
    recipient   String
    status      EmailStatus @default(PENDING)
    sentAt      DateTime?   @map("sent_at")
    deliveredAt DateTime?   @map("delivered_at")
    error       String?     @db.Text
    attempts    Int         @default(0)
    createdAt   DateTime    @default(now()) @map("created_at")
    updatedAt   DateTime    @updatedAt @map("updated_at")

    campaignId String   @map("campaign_id")
    campaign   Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)

    @@index([campaignId])
    @@index([status])
    @@index([recipient])
    @@map("email_logs")
}